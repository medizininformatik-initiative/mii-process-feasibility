version: '3.8'
services:

  # ---- Static cURL binary for health check in HAPI container
  hapi-curl-download:
    image: alpine:3.18
    command: >
      sh -c "wget https://github.com/moparisthebest/static-curl/releases/download/v8.1.2/curl-amd64 -O /opt/bin/curl &&
             chmod +x /opt/bin/curl"
    volumes:
    - type: volume
      source: hapi-curl-binary
      target: /opt/bin

  # ---- Proxy ----------------------------------------------------------------
  proxy:
    image: nginx:1.25.1
    restart: on-failure
    healthcheck:
      test: ["CMD-SHELL", "curl -ks https://localhost || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    ports:
    - "127.0.0.1:443:443"
    secrets:
    - proxy_certificate_and_int_cas.pem
    - proxy_certificate_private_key.pem
    - proxy_trusted_client_cas.pem
    volumes:
    - type: bind
      source: ./proxy/conf.d
      target: /etc/nginx/conf.d
      read_only: true
    - type: bind
      source: ./proxy/nginx.conf
      target: /etc/nginx/nginx.conf
      read_only: true
    networks:
      zars-fhir-frontend:
        ipv4_address: 172.10.0.66
      dic-1-fhir-frontend:
        ipv4_address: 172.10.0.82
      dic-2-fhir-frontend:
        ipv4_address: 172.10.0.98
      dic-3-fhir-frontend:
        ipv4_address: 172.10.0.114
      dic-4-fhir-frontend:
        ipv4_address: 172.10.0.130
      broker-dic-5-fhir-frontend:
        ipv4_address: 172.10.0.147
      broker-dic-6-fhir-frontend:
        ipv4_address: 172.10.0.163
      broker-fhir-frontend:
        ipv4_address: 172.10.0.179
      internet:
        aliases:
        - zars
        - dic-1
        - dic-2
        - dic-3
        - dic-4
        - broker-dic-5
        - broker-dic-6
        - broker
    environment:
      TZ: Europe/Berlin

  db:
    image: postgres:15-alpine
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      TZ: Europe/Berlin
      POSTGRES_PASSWORD_FILE: /run/secrets/db_liquibase.password
      POSTGRES_USER: liquibase_user
      POSTGRES_DB: postgres
    networks:
    - zars-fhir-backend
    - dic-1-fhir-backend
    - dic-2-fhir-backend
    - dic-3-fhir-backend
    - broker-dic-5-fhir-backend
    - broker-dic-6-fhir-backend
    - broker-fhir-backend
    - zars-bpe-backend
    - dic-1-bpe-backend
    - dic-2-bpe-backend
    - dic-3-bpe-backend
    - dic-4-bpe-backend
    - broker-dic-5-bpe-backend
    - broker-dic-6-bpe-backend
    - broker-bpe-backend
    secrets:
    - db_liquibase.password
    volumes:
    - type: volume
      source: db-data
      target: /var/lib/postgresql/data
    - type: bind
      source: ./db/init-db.sh
      target: /docker-entrypoint-initdb.d/init-db.sh
      read_only: true

  # ---- ZARS - FHIR Inbox ----------------------------------------------------
  zars-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_zars_user.password
    - db_fhir_zars_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_zars_client_certificate.pem
    - app_zars_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./zars/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./zars/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_zars_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_zars_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_zars_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_zars_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/zars_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: zars_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: zars_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: zars_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: zars_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://zars/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_ZARS
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${ZARS_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
              - WEBSOCKET
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
    networks:
      zars-fhir-frontend:
        ipv4_address: 172.10.0.69
      zars-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      proxy:
        condition: service_healthy

  # ---- ZARS - BPE -----------------------------------------------------------
  zars-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_zars_bpe_user.password
    - db_zars_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_zars_client_certificate.pem
    - app_zars_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./zars/bpe/plugin
      target: /opt/bpe/plugin
      read_only: true
    - type: bind
      source: ./zars/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./zars/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./zars/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_zars_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_zars_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_zars_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_zars_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/zars_bpe
      DEV_DSF_BPE_DB_USER_GROUP: zars_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: zars_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: zars_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: zars_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://zars/fhir
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
    networks:
      zars-bpe-frontend:
      zars-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      zars-fhir-app:
        condition:  service_healthy
        restart: true

  # ---- DIC-1 - FHIR ---------------------------------------------------------
  dic-1-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_1_user.password
    - db_fhir_dic_1_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_1_client_certificate.pem
    - app_dic_1_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-1/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-1/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_1_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_1_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_1_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_1_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_1_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_1_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_1_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_1_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_1_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-1/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_1
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_1_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-1-fhir-frontend:
        ipv4_address: 172.10.0.83
      dic-1-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      proxy:
        condition: service_healthy

  # ---- DIC-1 - BPE ----------------------------------------------------------
  dic-1-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_dic_1_bpe_user.password
    - db_dic_1_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_dic_1_client_certificate.pem
    - app_dic_1_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-1/bpe/plugin
      target: /opt/bpe/plugin
      read_only: true
    - type: bind
      source: ./dic-1/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./dic-1/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./dic-1/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_1_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_1_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_1_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_1_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_1_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_1_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_1_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_1_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_1_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-1/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_FLARE_BASE_URL: http://dic-1-store:8080/
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_FLARE_TIMEOUT_CONNECT: 2000
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: structured-query
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
    networks:
      dic-1-bpe-frontend:
      dic-1-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-1-fhir-app:
        condition: service_healthy
        restart: true
      dic-1-store:
        condition: service_healthy
        restart: true

  # ---- DIC-1 - FHIR Data Store ----------------------------------------------
  dic-1-store:
    image: ghcr.io/medizininformatik-initiative/flare:1.0.0
    restart: always
    ports:
    - "5000:8080"
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/cache/stats" ]
      interval: 10s
      timeout: 15s
      retries: 5
    environment:
      FLARE_FHIR_SERVER: http://dic-1-store-fhir-server:8080/fhir/
    networks:
      dic-1-bpe-backend:
    depends_on:
      dic-1-store-fhir-server:
        condition: service_healthy

  dic-1-store-fhir-server:
    image: hapiproject/hapi:v6.4.4
    healthcheck:
      test: [ "CMD", "/opt/bin/curl", "http://localhost:8080"]
      interval: 30s
      timeout: 5s
      retries: 5
    networks:
      dic-1-bpe-backend:
    restart: always
    ports:
    - "8081:8080"
    environment:
      SPRING_CONFIG_LOCATION: 'file:///data/hapi/application.yaml'
    volumes:
    - type: bind
      source: ./dic-1/fhir/conf/application.yaml
      target: /data/hapi/application.yaml
    volumes_from:
    - hapi-curl-download:ro
    depends_on:
      hapi-curl-download:
        condition: service_completed_successfully
      dic-1-store-db:
        condition: service_healthy

  dic-1-store-db:
    image: postgres:15-alpine
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      dic-1-bpe-backend:
    restart: always
    volumes:
    - type: volume
      source: dic-1-store-data
      target: /var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: fhir

  # ---- DIC-2 - FHIR ---------------------------------------------------------
  dic-2-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_2_user.password
    - db_fhir_dic_2_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_2_client_certificate.pem
    - app_dic_2_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-2/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-2/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_2_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_2_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_2_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_2_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_2_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_2_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_2_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_2_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_2_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-2/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_2
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_2_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-2-fhir-frontend:
        ipv4_address: 172.10.0.99
      dic-2-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      proxy:
        condition: service_healthy

  # ---- DIC-2 - BPE ----------------------------------------------------------
  dic-2-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_dic_2_bpe_user.password
    - db_dic_2_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_dic_2_client_certificate.pem
    - app_dic_2_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-2/bpe/plugin
      target: /opt/bpe/plugin
      read_only: true
    - type: bind
      source: ./dic-2/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./dic-2/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./dic-2/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_2_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_2_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_2_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_2_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_2_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_2_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_2_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_2_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_2_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-2/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://dic-2-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "true"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
    networks:
      dic-2-bpe-frontend:
      dic-2-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-2-fhir-app:
        condition:  service_healthy
        restart: true
      dic-2-store:
        condition: service_healthy
        restart: true

  # ---- DIC-2 - FHIR Data Store ----------------------------------------------
  dic-2-store:
    image: samply/blaze:0.24
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    ports:
    - "127.0.0.1:8080:8080"
    environment:
      BASE_URL: http://127.0.0.1:8080
      LOG_LEVEL: debug
    networks:
      dic-2-bpe-backend:
        aliases:
          - dic-2-store
    volumes:
    - type: volume
      source: dic-2-store-data
      target: /app/data

  # ---- DIC-3 - FHIR ---------------------------------------------------------
  dic-3-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_fhir_dic_3_user.password
      - db_fhir_dic_3_user_permanent_delete.password
      - app_client_trust_certificates.pem
      - app_dic_3_client_certificate.pem
      - app_dic_3_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-3/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
      - type: bind
        source: ./dic-3/fhir/log
        target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_3_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_3_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_3_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_3_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_3_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_3_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_3_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_3_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_3_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-3/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_3
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_3_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-3-fhir-frontend:
        ipv4_address: 172.10.0.115
      dic-3-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy

  # ---- DIC-3 - BPE ----------------------------------------------------------
  dic-3-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_dic_3_bpe_user.password
      - db_dic_3_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - dic_3_store_proxy_self_signed_ca.p12
      - app_dic_3_client_certificate.pem
      - app_dic_3_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-3/bpe/plugin
        target: /opt/bpe/plugin
        read_only: true
      - type: bind
        source: ./dic-3/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic-3/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic-3/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_3_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_3_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_3_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_3_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_3_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_3_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_3_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_3_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_3_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-3/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_TRUST_STORE_PATH: /run/secrets/dic_3_store_proxy_self_signed_ca.p12
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_TRUST_STORE_PASSWORD: "testpw"
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_AUTH_BASIC_USERNAME: test
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_AUTH_BASIC_PASSWORD: PF4Q4pEpXFkYToPSDre5tFr9P9MkqeDc
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: https://dic-3-store-proxy/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
    networks:
      dic-3-bpe-frontend:
      dic-3-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-3-fhir-app:
        condition: service_healthy
        restart: true
      dedicated-dic-3-store-proxy:
        condition: service_healthy

  # ---- DIC-3 - DEDICATED PROXY WITH SELF SIGNED CERT ------------------------
  dedicated-dic-3-store-proxy:
    image: nginx:1.25.1
    restart: on-failure
    healthcheck:
      test: ["CMD-SHELL", "curl -ks https://localhost || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    ports:
    - "127.0.0.1:10443:443"
    secrets:
    - dic_3_store_proxy_cert_bundle.pem
    - dic_3_store_proxy_cert_key.pem
    - dic_3_store_proxy.htpasswd
    volumes:
    - type: bind
      source: ./dic-3-store-proxy/nginx.conf
      target: /etc/nginx/nginx.conf
      read_only: true
    networks:
      dic-3-fhir-frontend:
        ipv4_address: 172.10.0.116
      dic-3-bpe-backend:
      internet:
        aliases:
        - dic-3-store-proxy
    environment:
      TZ: Europe/Berlin
    depends_on:
    - dic-3-store

  # ---- DIC-3 - FHIR Data Store ----------------------------------------------
  dic-3-store:
    image: samply/blaze:0.24
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    ports:
    - "8072:8080"
    environment:
      BASE_URL: http://localhost:8072
      LOG_LEVEL: debug
    networks:
      dic-3-fhir-frontend:
        ipv4_address: 172.10.0.117
      dic-3-bpe-backend:
    volumes:
    - type: volume
      source: dic-3-store-data
      target: /app/data

  # ---- DIC-4 - FHIR ---------------------------------------------------------
  dic-4-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_4_user.password
    - db_fhir_dic_4_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_4_client_certificate.pem
    - app_dic_4_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-4/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-4/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_4_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_4_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_4_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_4_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_4_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_4_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_4_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_4_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_4_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-4/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_4
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_4_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-4-fhir-frontend:
        ipv4_address: 172.10.0.131
      dic-4-fhir-backend:
      internet:
    depends_on:
    - db
    - proxy

  # ---- DIC-4 - BPE ----------------------------------------------------------
  dic-4-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_dic_4_bpe_user.password
      - db_dic_4_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - app_dic_4_client_certificate.pem
      - app_dic_4_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-4/bpe/plugin
        target: /opt/bpe/plugin
        read_only: true
      - type: bind
        source: ./dic-4/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic-4/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic-4/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_4_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_4_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_4_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_4_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_4_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_4_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_4_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_4_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_4_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-4/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://dic-4-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
    networks:
      dic-4-bpe-frontend:
      dic-4-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      dic-4-fhir-app:
        condition: service_healthy
      dic-4-store-init:
        condition: service_completed_successfully

  #dic-4-bpe-app: todo

  # ---- DIC-4 - FHIR Data Store ----------------------------------------------
  dic-4-store:
    image: hapiproject/hapi:v6.4.4
    restart: always
    ports:
    - "8082:8080"
    healthcheck:
      test: [ "CMD", "/opt/bin/curl", "http://localhost:8080"]
      interval: 30s
      timeout: 5s
      retries: 5
    environment:
      SPRING_CONFIG_LOCATION: 'file:///data/hapi/application.yaml'
    networks:
      dic-4-bpe-backend:
    volumes:
    - type: bind
      source: ./dic-4/fhir/conf/application.yaml
      target: /data/hapi/application.yaml
    volumes_from:
    - hapi-curl-download:ro
    depends_on:
      hapi-curl-download:
        condition: service_completed_successfully
      dic-4-store-db:
        condition: service_healthy

  dic-4-store-init:
    image: curlimages/curl:7.85.0
    entrypoint:
      - /bin/sh
    command:
      - /tmp/init.sh
    volumes:
      - type: bind
        source: ./dic-4-store-init/init.sh
        target: /tmp/init.sh
      - type: bind
        source: ./dic-4-store-init/library-fhir-helpers.json
        target: /tmp/library-fhir-helpers.json
      - type: bind
        source: ./dic-4-store-init/library-fhir-model-definition.json
        target: /tmp/library-fhir-model-definition.json
    networks:
      dic-4-bpe-backend:
    depends_on:
      dic-4-store:
        condition: service_healthy

  dic-4-store-db:
    image: postgres:15-alpine
    networks:
      dic-4-bpe-backend:
    restart: always
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
    - type: volume
      source: dic-4-store-data
      target: /var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: fhir

  # ---- BROKER-DIC-5 - FHIR ---------------------------------------------------------
  broker-dic-5-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.5.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_fhir_broker_dic_5_user.password
      - db_fhir_broker_dic_5_user_permanent_delete.password
      - app_client_trust_certificates.pem
      - app_broker_dic_5_client_certificate.pem
      - app_broker_dic_5_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker-dic-5/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
      - type: bind
        source: ./broker-dic-5/fhir/log
        target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_broker_dic_5_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_broker_dic_5_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_dic_5_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_dic_5_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/broker_dic_5_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: broker_dic_5_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: broker_dic_5_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: broker_dic_5_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: broker_dic_5_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://broker-dic-5/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_Broker_DIC_5
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${BROKER_DIC_5_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      broker-dic-5-fhir-frontend:
        ipv4_address: 172.10.0.148
      broker-dic-5-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      proxy:
        condition: service_healthy

  # ---- BROKER-DIC-5 - BPE ---------------------------------------------------------- todo
  broker-dic-5-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_broker_dic_5_bpe_user.password
      - db_broker_dic_5_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - app_broker_dic_5_client_certificate.pem
      - app_broker_dic_5_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker-dic-5/bpe/plugin
        target: /opt/bpe/plugin
        read_only: true
      - type: bind
        source: ./broker-dic-5/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./broker-dic-5/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./broker-dic-5/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_broker_dic_5_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_broker_dic_5_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_dic_5_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_dic_5_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/broker_dic_5_bpe
      DEV_DSF_BPE_DB_USER_GROUP: broker_dic_5_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: broker_dic_5_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: broker_dic_5_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: broker_dic_5_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://broker-dic-5/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://broker-dic-5-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_DISTRIBUTION_SUBDIC: "true"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "distributed-org.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "distributed-org.de"
    networks:
      broker-dic-5-bpe-frontend:
      broker-dic-5-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      broker-dic-5-fhir-app:
        condition:  service_healthy
        restart: true
      broker-dic-5-store:
        condition: service_healthy
        restart: true

  # ---- BROKER-DIC-5 - FHIR Data Store ----------------------------------------------
  broker-dic-5-store:
    image: samply/blaze:0.24
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    ports:
      - "8085:8080"
    environment:
      BASE_URL: http://127.0.0.1:8085
      LOG_LEVEL: debug
    networks:
      broker-dic-5-bpe-backend:
        aliases:
          - broker-dic-5-store
    volumes:
      - type: volume
        source: broker-dic-5-store-data
        target: /app/data

  # ---- BROKER-DIC-6 - FHIR ---------------------------------------------------------
  broker-dic-6-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.5.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_fhir_broker_dic_6_user.password
      - db_fhir_broker_dic_6_user_permanent_delete.password
      - app_client_trust_certificates.pem
      - app_broker_dic_6_client_certificate.pem
      - app_broker_dic_6_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker-dic-6/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
      - type: bind
        source: ./broker-dic-6/fhir/log
        target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_broker_dic_6_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_broker_dic_6_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_dic_6_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_dic_6_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/broker_dic_6_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: broker_dic_6_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: broker_dic_6_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: broker_dic_6_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: broker_dic_6_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://broker-dic-6/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_Broker_DIC_6
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${BROKER_DIC_6_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      broker-dic-6-fhir-frontend:
        ipv4_address: 172.10.0.164
      dic-2-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      proxy:
        condition: service_healthy

  # ---- BROKER-DIC-6 - BPE ---------------------------------------------------------- todo
  broker-dic-6-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_broker_dic_6_bpe_user.password
      - db_broker_dic_6_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - app_broker_dic_6_client_certificate.pem
      - app_broker_dic_6_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker-dic-6/bpe/plugin
        target: /opt/bpe/plugin
        read_only: true
      - type: bind
        source: ./broker-dic-6/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./broker-dic-6/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./broker-dic-6/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_broker_dic_6_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_broker_dic_6_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_dic_6_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_dic_6_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/broker_dic_6_bpe
      DEV_DSF_BPE_DB_USER_GROUP: broker_dic_6_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: broker_dic_6_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: broker_dic_6_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: broker_dic_6_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://broker-dic-6/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://broker-dic-6-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_DISTRIBUTION_SUBDIC: "true"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "distributed-org.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "distributed-org.de"
    networks:
      broker-dic-6-bpe-frontend:
      broker-dic-6-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      broker-dic-6-fhir-app:
        condition:  service_healthy
        restart: true
      broker-dic-6-store:
        condition: service_healthy
        restart: true

  # ---- BROKER-DIC-6 - FHIR Data Store ----------------------------------------------
  broker-dic-6-store:
    image: samply/blaze:0.24
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    ports:
     - "8086:8080"
    environment:
      BASE_URL: http://127.0.0.1:8086
      LOG_LEVEL: debug
    networks:
      broker-dic-6-bpe-backend:
        aliases:
          - broker-dic-6-store
    volumes:
      - type: volume
        source: broker-dic-6-store-data
        target: /app/data


  # ---- BROKER - FHIR ---------------------------------------------------------
  broker-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_fhir_broker_user.password
      - db_fhir_broker_user_permanent_delete.password
      - app_client_trust_certificates.pem
      - app_broker_client_certificate.pem
      - app_broker_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
      - type: bind
        source: ./broker/fhir/log
        target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_broker_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_broker_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/broker_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: broker_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: broker_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: broker_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: broker_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://broker/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_Broker
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${BROKER_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
              - WEBSOCKET
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
    networks:
      broker-fhir-frontend:
        ipv4_address: 172.10.0.180
      broker-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      proxy:
        condition: service_healthy

  # ---- BROKER - BPE ---------------------------------------------------------- todo
  broker-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.3.1
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_broker_bpe_user.password
      - db_broker_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - app_broker_client_certificate.pem
      - app_broker_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./broker/bpe/plugin
        target: /opt/bpe/plugin
        read_only: true
      - type: bind
        source: ./broker/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./broker/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./broker/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_broker_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_broker_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_broker_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_broker_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/broker_bpe
      DEV_DSF_BPE_DB_USER_GROUP: broker_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: broker_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: broker_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: broker_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://broker/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "true"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_DISTRIBUTION: true
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_EXECUTE_ORGANIZATION_IDENTIFIER_VALUE: "medizininformatik-initiative.de"
      EDU_UBI_MEDFAK_FEASIBILITY_DSF_PROCESS_REQUEST_ORGANIZATION_IDENTIFIER_VALUE: "distributed-org.de"
    networks:
      broker-bpe-frontend:
      broker-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      broker-fhir-app:
        condition:  service_healthy
        restart: true


secrets:
  proxy_certificate_and_int_cas.pem:
    file: ./secrets/proxy_certificate_and_int_cas.pem
  proxy_certificate_private_key.pem:
    file: ./secrets/proxy_certificate_private_key.pem
  proxy_trusted_client_cas.pem:
    file: ./secrets/proxy_trusted_client_cas.pem

  app_client_trust_certificates.pem:
    file: ./secrets/app_client_trust_certificates.pem
  app_client_certificate_private_key.pem.password:
    file: ./secrets/app_client_certificate_private_key.pem.password

  db_liquibase.password:
    file: ./secrets/db_liquibase.password

  db_zars_bpe_user.password:
    file: secrets/db_zars_bpe_user.password
  db_zars_bpe_user_camunda.password:
    file: secrets/db_zars_bpe_user_camunda.password
  app_zars_client_certificate.pem:
    file: ./secrets/app_zars_client_certificate.pem
  app_zars_client_certificate_private_key.pem:
    file: ./secrets/app_zars_client_certificate_private_key.pem
  db_fhir_zars_user.password:
    file: ./secrets/db_fhir_zars_user.password
  db_fhir_zars_user_permanent_delete.password:
    file: ./secrets/db_fhir_zars_user_permanent_delete.password

  db_dic_1_bpe_user.password:
    file: secrets/db_dic_1_bpe_user.password
  db_dic_1_bpe_user_camunda.password:
    file: secrets/db_dic_1_bpe_user_camunda.password
  app_dic_1_client_certificate.pem:
    file: ./secrets/app_dic_1_client_certificate.pem
  app_dic_1_client_certificate_private_key.pem:
    file: ./secrets/app_dic_1_client_certificate_private_key.pem
  db_fhir_dic_1_user.password:
    file: ./secrets/db_fhir_dic_1_user.password
  db_fhir_dic_1_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_1_user_permanent_delete.password

  db_dic_2_bpe_user.password:
    file: secrets/db_dic_2_bpe_user.password
  db_dic_2_bpe_user_camunda.password:
    file: secrets/db_dic_2_bpe_user_camunda.password
  app_dic_2_client_certificate.pem:
    file: ./secrets/app_dic_2_client_certificate.pem
  app_dic_2_client_certificate_private_key.pem:
    file: ./secrets/app_dic_2_client_certificate_private_key.pem
  db_fhir_dic_2_user.password:
    file: ./secrets/db_fhir_dic_2_user.password
  db_fhir_dic_2_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_2_user_permanent_delete.password

  db_dic_3_bpe_user.password:
    file: secrets/db_dic_3_bpe_user.password
  db_dic_3_bpe_user_camunda.password:
    file: secrets/db_dic_3_bpe_user_camunda.password
  app_dic_3_client_certificate.pem:
    file: ./secrets/app_dic_3_client_certificate.pem
  app_dic_3_client_certificate_private_key.pem:
    file: ./secrets/app_dic_3_client_certificate_private_key.pem
  db_fhir_dic_3_user.password:
    file: ./secrets/db_fhir_dic_3_user.password
  db_fhir_dic_3_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_3_user_permanent_delete.password

  dic_3_store_proxy.htpasswd:
    file: ./secrets/dic_3_store_proxy.htpasswd
  dic_3_store_proxy_cert_bundle.pem:
    file: ./secrets/dic_3_store_proxy_cert_bundle.pem
  dic_3_store_proxy_cert_key.pem:
    file: ./secrets/dic_3_store_proxy_cert_key.pem
  dic_3_store_proxy_self_signed_ca.p12:
    file: ./secrets/dic_3_store_proxy_self_signed_ca.p12

  db_dic_4_bpe_user.password:
    file: secrets/db_dic_4_bpe_user.password
  db_dic_4_bpe_user_camunda.password:
    file: secrets/db_dic_4_bpe_user_camunda.password
  app_dic_4_client_certificate.pem:
    file: ./secrets/app_dic_4_client_certificate.pem
  app_dic_4_client_certificate_private_key.pem:
    file: ./secrets/app_dic_4_client_certificate_private_key.pem
  db_fhir_dic_4_user.password:
    file: ./secrets/db_fhir_dic_4_user.password
  db_fhir_dic_4_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_4_user_permanent_delete.password

  db_broker_dic_5_bpe_user.password:
    file: secrets/db_broker_dic_5_bpe_user.password
  db_broker_dic_5_bpe_user_camunda.password:
    file: secrets/db_broker_dic_5_bpe_user_camunda.password
  app_broker_dic_5_client_certificate.pem:
    file: ./secrets/app_broker_dic_5_client_certificate.pem
  app_broker_dic_5_client_certificate_private_key.pem:
    file: ./secrets/app_broker_dic_5_client_certificate_private_key.pem
  db_fhir_broker_dic_5_user.password:
    file: ./secrets/db_fhir_broker_dic_5_user.password
  db_fhir_broker_dic_5_user_permanent_delete.password:
    file: ./secrets/db_fhir_broker_dic_5_user_permanent_delete.password

  db_broker_dic_6_bpe_user.password:
    file: secrets/db_broker_dic_6_bpe_user.password
  db_broker_dic_6_bpe_user_camunda.password:
    file: secrets/db_broker_dic_6_bpe_user_camunda.password
  app_broker_dic_6_client_certificate.pem:
    file: ./secrets/app_broker_dic_6_client_certificate.pem
  app_broker_dic_6_client_certificate_private_key.pem:
    file: ./secrets/app_broker_dic_6_client_certificate_private_key.pem
  db_fhir_broker_dic_6_user.password:
    file: ./secrets/db_fhir_broker_dic_6_user.password
  db_fhir_broker_dic_6_user_permanent_delete.password:
    file: ./secrets/db_fhir_broker_dic_6_user_permanent_delete.password

  db_broker_bpe_user.password:
    file: secrets/db_broker_bpe_user.password
  db_broker_bpe_user_camunda.password:
    file: secrets/db_broker_bpe_user_camunda.password
  app_broker_client_certificate.pem:
    file: ./secrets/app_broker_client_certificate.pem
  app_broker_client_certificate_private_key.pem:
    file: ./secrets/app_broker_client_certificate_private_key.pem
  db_fhir_broker_user.password:
    file: ./secrets/db_fhir_broker_user.password
  db_fhir_broker_user_permanent_delete.password:
    file: ./secrets/db_fhir_broker_user_permanent_delete.password

networks:
  internet:
  zars-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.64/28
  zars-fhir-backend:
  zars-bpe-frontend:
  zars-bpe-backend:

  dic-1-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.80/28
  dic-1-fhir-backend:
  dic-1-bpe-frontend:
  dic-1-bpe-backend:

  dic-2-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.96/28
  dic-2-fhir-backend:
  dic-2-bpe-frontend:
  dic-2-bpe-backend:

  dic-3-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.112/28
  dic-3-fhir-backend:
  dic-3-bpe-frontend:
  dic-3-bpe-backend:

  dic-4-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.128/28
  dic-4-fhir-backend:
  dic-4-bpe-frontend:
  dic-4-bpe-backend:

  broker-dic-5-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.10.0.144/28
  broker-dic-5-fhir-backend:
  broker-dic-5-bpe-frontend:
  broker-dic-5-bpe-backend:

  broker-dic-6-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.10.0.160/28
  broker-dic-6-fhir-backend:
  broker-dic-6-bpe-frontend:
  broker-dic-6-bpe-backend:

  broker-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.10.0.176/28
  broker-fhir-backend:
  broker-bpe-frontend:
  broker-bpe-backend:


volumes:
  hapi-curl-binary:
    name: "hapi-curl-binary"

  dic-1-store-data:
    name: "dic-1-store-data"

  dic-2-store-data:
    name: "dic-2-store-data"

  dic-3-store-data:
    name: "dic-3-store-data"

  dic-4-store-data:
    name: "dic-4-store-data"

  broker-dic-5-store-data:
    name: "broker-dic-5-store-data"

  broker-dic-6-store-data:
    name: "broker-dic-6-store-data"

#  broker-store-data:
#    name: "broker-store-data"

  db-data:
    name: "db-data-mii-dsf-process-feasibility"
