services:

  # ---- Static cURL binary for health check in HAPI container
  hapi-curl-download:
    image: alpine:3.21
    command: >
      sh -c "wget https://github.com/moparisthebest/static-curl/releases/download/v8.1.2/curl-amd64 -O /opt/bin/curl &&
             chmod +x /opt/bin/curl"
    volumes:
    - type: volume
      source: hapi-curl-binary
      target: /opt/bin

  # ---- Proxy ----------------------------------------------------------------
  proxy:
    image: nginx:1.27.3
    restart: on-failure
    healthcheck:
      test: ["CMD-SHELL", "curl -ks https://localhost || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    ports:
    - "127.0.0.1:443:443"
    secrets:
    - proxy_certificate_and_int_cas.pem
    - proxy_certificate_private_key.pem
    - proxy_trusted_client_cas.pem
    volumes:
    - type: bind
      source: ./proxy/conf.d
      target: /etc/nginx/conf.d
      read_only: true
    - type: bind
      source: ./proxy/nginx.conf
      target: /etc/nginx/nginx.conf
      read_only: true
    networks:
      zars-fhir-frontend:
      dic-1-fhir-frontend:
      dic-2-fhir-frontend:
      dic-3-fhir-frontend:
      dic-4-fhir-frontend:
      internet:
        aliases:
        - zars
        - dic-1
        - dic-2
        - dic-3
        - dic-4
    environment:
      TZ: Europe/Berlin

  db:
    image: postgres:17-alpine
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U liquibase_user -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      TZ: Europe/Berlin
      POSTGRES_PASSWORD_FILE: /run/secrets/db_liquibase.password
      POSTGRES_USER: liquibase_user
      POSTGRES_DB: postgres
    networks:
    - zars-fhir-backend
    - dic-1-fhir-backend
    - dic-2-fhir-backend
    - dic-3-fhir-backend
    - dic-4-fhir-backend
    - zars-bpe-backend
    - dic-1-bpe-backend
    - dic-2-bpe-backend
    - dic-3-bpe-backend
    - dic-4-bpe-backend
    secrets:
    - db_liquibase.password
    volumes:
    - type: volume
      source: db-data
      target: /var/lib/postgresql/data
    - type: bind
      source: ./db/init-db.sh
      target: /docker-entrypoint-initdb.d/init-db.sh
      read_only: true

  # ---- ZARS - FHIR Inbox ----------------------------------------------------
  zars-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_zars_user.password
    - db_fhir_zars_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_zars_client_certificate.pem
    - app_zars_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./zars/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./zars/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_zars_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_zars_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_zars_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_zars_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/zars_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: zars_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: zars_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: zars_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: zars_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://zars/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_ZARS
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${ZARS_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
              - WEBSOCKET
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
    networks:
      zars-fhir-frontend:
      zars-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      proxy:
        condition: service_healthy

  # ---- ZARS - BPE -----------------------------------------------------------
  zars-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_zars_bpe_user.password
    - db_zars_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_zars_client_certificate.pem
    - app_zars_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./zars/bpe/plugin
      target: /opt/bpe/plugin
      read_only: true
    - type: bind
      source: ./zars/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./zars/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./zars/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_zars_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_zars_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_zars_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_zars_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/zars_bpe
      DEV_DSF_BPE_DB_USER_GROUP: zars_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: zars_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: zars_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: zars_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://zars/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED:  medizininformatik-initiativede_feasibilityExecute|0.0
    networks:
      zars-bpe-frontend:
      zars-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      zars-fhir-app:
        condition:  service_healthy
        restart: true

  # ---- DIC-1 - FHIR ---------------------------------------------------------
  dic-1-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_1_user.password
    - db_fhir_dic_1_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_1_client_certificate.pem
    - app_dic_1_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-1/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-1/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_1_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_1_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_1_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_1_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_1_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_1_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_1_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_1_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_1_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-1/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_1
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_1_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-1-fhir-frontend:
      dic-1-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      proxy:
        condition: service_healthy

  # ---- DIC-1 - BPE ----------------------------------------------------------
  dic-1-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_dic_1_bpe_user.password
    - db_dic_1_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_dic_1_client_certificate.pem
    - app_dic_1_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-1/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./dic-1/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./dic-1/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_1_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_1_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_1_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_1_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_1_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_1_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_1_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_1_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_1_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-1/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED:  medizininformatik-initiativede_feasibilityRequest|0.0
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_FLARE_BASE_URL: http://dic-1-store:8080/
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_FLARE_TIMEOUT_CONNECT: 2000
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: structured-query
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
    networks:
      dic-1-bpe-frontend:
      dic-1-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-1-fhir-app:
        condition: service_healthy
        restart: true
      dic-1-store:
        condition: service_healthy
        restart: true

  # ---- DIC-1 - FHIR Data Store ----------------------------------------------
  dic-1-store:
    image: ghcr.io/medizininformatik-initiative/flare:2.5.0
    restart: always
    ports:
    - "5000:8080"
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/cache/stats" ]
      interval: 10s
      timeout: 15s
      retries: 5
    environment:
      FLARE_FHIR_SERVER: http://dic-1-store-fhir-server:8080/fhir/
    networks:
      dic-1-bpe-backend:
    depends_on:
      dic-1-store-fhir-server:
        condition: service_healthy

  dic-1-store-fhir-server:
    image: hapiproject/hapi:v7.6.0
    healthcheck:
      test: [ "CMD", "/opt/bin/curl", "http://localhost:8080"]
      interval: 30s
      timeout: 5s
      retries: 5
    networks:
      dic-1-bpe-backend:
    restart: always
    ports:
    - "8081:8080"
    environment:
      SPRING_CONFIG_LOCATION: 'file:///data/hapi/application.yaml'
    volumes:
    - type: bind
      source: ./dic-1/fhir/conf/application.yaml
      target: /data/hapi/application.yaml
    volumes_from:
    - hapi-curl-download:ro
    depends_on:
      hapi-curl-download:
        condition: service_completed_successfully
      dic-1-store-db:
        condition: service_healthy

  dic-1-store-db:
    image: postgres:17-alpine
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      dic-1-bpe-backend:
    restart: always
    volumes:
    - type: volume
      source: dic-1-store-data
      target: /var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: fhir

  # ---- DIC-2 - FHIR ---------------------------------------------------------
  dic-2-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_2_user.password
    - db_fhir_dic_2_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_2_client_certificate.pem
    - app_dic_2_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-2/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-2/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_2_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_2_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_2_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_2_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_2_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_2_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_2_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_2_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_2_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-2/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_2
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_2_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-2-fhir-frontend:
      dic-2-fhir-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      proxy:
        condition: service_healthy


  # ---- DIC-2 - BPE ----------------------------------------------------------
  dic-2-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_dic_2_bpe_user.password
    - db_dic_2_bpe_user_camunda.password
    - app_client_trust_certificates.pem
    - app_dic_2_client_certificate.pem
    - app_dic_2_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-2/bpe/process
      target: /opt/bpe/process
      read_only: true
    - type: bind
      source: ./dic-2/bpe/log
      target: /opt/bpe/log
    - type: bind
      source: ./dic-2/bpe/cache
      target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_2_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_2_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_2_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_2_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_2_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_2_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_2_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_2_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_2_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-2/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED:  medizininformatik-initiativede_feasibilityRequest|0.0
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://dic-2-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "true"
    networks:
      dic-2-bpe-frontend:
      dic-2-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-2-fhir-app:
        condition:  service_healthy
        restart: true
      dic-2-store:
        condition: service_healthy
        restart: true

  # ---- DIC-2 - FHIR Data Store ----------------------------------------------
  dic-2-store:
    image: samply/blaze:0.31
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    ports:
    - "127.0.0.1:8080:8080"
    environment:
      BASE_URL: http://127.0.0.1:8080
      LOG_LEVEL: debug
    networks:
      dic-2-bpe-backend:
        aliases:
          - dic-2-store
    volumes:
    - type: volume
      source: dic-2-store-data
      target: /app/data

  # ---- DIC-3 - FHIR ---------------------------------------------------------
  dic-3-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_fhir_dic_3_user.password
      - db_fhir_dic_3_user_permanent_delete.password
      - app_client_trust_certificates.pem
      - app_dic_3_client_certificate.pem
      - app_dic_3_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-3/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
      - type: bind
        source: ./dic-3/fhir/log
        target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_3_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_3_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_3_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_3_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_3_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_3_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_3_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_3_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_3_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-3/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_3
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_3_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-3-fhir-frontend:
      dic-3-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy

  # ---- DIC-3 - BPE ----------------------------------------------------------
  dic-3-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_dic_3_bpe_user.password
      - db_dic_3_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - dic_3_store_proxy_self_signed_ca.p12
      - app_dic_3_client_certificate.pem
      - app_dic_3_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-3/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic-3/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic-3/bpe/cache
        target: /opt/bpe/cache
    ports:
    - 5005:5005
    environment:
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_3_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_3_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_3_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_3_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_3_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_3_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_3_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_3_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_3_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-3/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED:  medizininformatik-initiativede_feasibilityRequest|0.0
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_TRUST_STORE_PATH: /run/secrets/dic_3_store_proxy_self_signed_ca.p12
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_TRUST_STORE_PASSWORD: "testpw"
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_AUTH_OAUTH_ISSUER_URL: "https://dic-3-keycloak-proxy/realms/test"
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_AUTH_OAUTH_CLIENT_ID: "account"
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_AUTH_OAUTH_CLIENT_PASSWORD: "test"
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: https://dic-3-store-proxy/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
    networks:
      dic-3-bpe-frontend:
      dic-3-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
        restart: true
      dic-3-fhir-app:
        condition: service_healthy
        restart: true
      dic-3-store-proxy:
        condition: service_healthy
      dic-3-keycloak:
        condition: service_healthy

  # ---- DIC-3 - DEDICATED PROXY WITH SELF SIGNED CERT ------------------------
  dic-3-keycloak:
    image: "keycloak/keycloak:26.1.0"
    command: ["start", "--import-realm"]
    healthcheck:
      test: ["CMD-SHELL", "exec 3<>/dev/tcp/127.0.0.1/9000;echo -e \"GET /health/ready HTTP/1.1\r\nhost: localhost\r\nConnection: close\r\n\r\n\" >&3;grep \"HTTP/1.1 200 OK\" <&3"]
      interval: "5s"
      timeout: "5s"
      retries: 3
      start_period: "30s"
    networks:
      dic-3-keycloak:
    environment:
      KC_HOSTNAME: "https://dic-3-keycloak-proxy"
      KC_HOSTNAME_ADMIN: "https://dic-3-keycloak-proxy"
      KC_HTTP_RELATIVE_PATH: "/"
      KC_PROXY_HEADERS: "xforwarded"
      KC_HTTP_ENABLED: "true"
      KC_HEALTH_ENABLED: "true"
      KC_LOG_LEVEL: "info"
    volumes:
    - "./dic-3/keycloak/realm-test.json:/opt/keycloak/data/import/realm-test.json"
  dic-3-store-proxy:
    image: nginx:1.27.3
    restart: on-failure
    healthcheck:
      test: ["CMD-SHELL", "curl -ks https://localhost || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    ports:
    - "127.0.0.1:10443:443"
    secrets:
    - dic_3_store_proxy_cert_bundle.pem
    - dic_3_store_proxy_cert_key.pem
    - dic_3_store_proxy.htpasswd
    volumes:
    - type: bind
      source: ./dic-3/proxy/nginx.conf
      target: /etc/nginx/nginx.conf
      read_only: true
    networks:
      dic-3-fhir-frontend:
      dic-3-bpe-backend:
      dic-3-keycloak:
      internet:
        aliases:
        - dic-3-store-proxy
        - dic-3-keycloak-proxy
    environment:
      TZ: Europe/Berlin
    depends_on:
    - dic-3-store

  # ---- DIC-3 - FHIR Data Store ----------------------------------------------
  dic-3-store:
    image: samply/blaze:0.31.0
    restart: on-failure
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:8080/health" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - dic_3_store_proxy_self_signed_ca.p12
    ports:
    - "8072:8080"
    environment:
      BASE_URL: https://dic-3-store-proxy
      LOG_LEVEL: debug
      OPENID_PROVIDER_URL: "https://dic-3-keycloak-proxy/realms/test"
      OPENID_CLIENT_TRUST_STORE: "/run/secrets/dic_3_store_proxy_self_signed_ca.p12"
      OPENID_CLIENT_TRUST_STORE_PASS: "testpw"
    networks:
      dic-3-fhir-frontend:
      dic-3-bpe-backend:
      internet:
    volumes:
    - type: volume
      source: dic-3-store-data
      target: /app/data

  # ---- DIC-4 - FHIR ---------------------------------------------------------
  dic-4-fhir-app:
    image: ghcr.io/datasharingframework/fhir:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
    - db_liquibase.password
    - db_fhir_dic_4_user.password
    - db_fhir_dic_4_user_permanent_delete.password
    - app_client_trust_certificates.pem
    - app_dic_4_client_certificate.pem
    - app_dic_4_client_certificate_private_key.pem
    - app_client_certificate_private_key.pem.password
    volumes:
    - type: bind
      source: ./dic-4/fhir/conf/bundle.xml
      target: /opt/fhir/conf/bundle.xml
    - type: bind
      source: ./dic-4/fhir/log
      target: /opt/fhir/log
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_fhir_dic_4_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_fhir_dic_4_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_4_client_certificate.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_4_client_certificate_private_key.pem
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic_4_fhir
      DEV_DSF_FHIR_DB_USER_GROUP: dic_4_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic_4_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic_4_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic_4_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic-4/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_4
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT: ${DIC_4_USER_THUMBPRINTS}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE
              - READ
              - UPDATE
              - DELETE
              - SEARCH
              - HISTORY
              - PERMANENT_DELETE
    networks:
      dic-4-fhir-frontend:
      dic-4-fhir-backend:
      internet:
    depends_on:
    - db
    - proxy

  # ---- DIC-4 - BPE ----------------------------------------------------------
  dic-4-bpe-app:
    image: ghcr.io/datasharingframework/bpe:1.7.0
    restart: on-failure
    healthcheck:
      test: [ "CMD-SHELL", "./healthcheck.sh" ]
      interval: 10s
      timeout: 15s
      retries: 5
    secrets:
      - db_liquibase.password
      - db_dic_4_bpe_user.password
      - db_dic_4_bpe_user_camunda.password
      - app_client_trust_certificates.pem
      - app_dic_4_client_certificate.pem
      - app_dic_4_client_certificate_private_key.pem
      - app_client_certificate_private_key.pem.password
    volumes:
      - type: bind
        source: ./dic-4/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic-4/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic-4/bpe/cache
        target: /opt/bpe/cache
    environment:
      TZ: Europe/Berlin
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic_4_bpe_user.password
      DEV_DSF_BPE_DB_USER_CAMUNDA_PASSWORD_FILE: /run/secrets/db_dic_4_bpe_user_camunda.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/app_client_trust_certificates.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/app_dic_4_client_certificate.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/app_dic_4_client_certificate_private_key.pem
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/app_client_certificate_private_key.pem.password
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic_4_bpe
      DEV_DSF_BPE_DB_USER_GROUP: dic_4_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic_4_bpe_server_user
      DEV_DSF_BPE_DB_USER_CAMUNDA_GROUP: dic_4_camunda_users
      DEV_DSF_BPE_DB_USER_CAMUNDA_USERNAME: dic_4_camunda_server_user
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic-4/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED:  medizininformatik-initiativede_feasibilityRequest|0.0
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_CLIENT_STORE_BASE_URL: http://dic-4-store:8080/fhir
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_STRATEGY: cql
      DE_MEDIZININFORMATIK_INITIATIVE_FEASIBILITY_DSF_PROCESS_EVALUATION_OBFUSCATE: "false"
    networks:
      dic-4-bpe-frontend:
      dic-4-bpe-backend:
      internet:
    depends_on:
      db:
        condition: service_healthy
      dic-4-fhir-app:
        condition: service_healthy
      dic-4-store-init:
        condition: service_completed_successfully

  # ---- DIC-4 - FHIR Data Store ----------------------------------------------
  dic-4-store:
    image: hapiproject/hapi:v7.6.0
    restart: always
    ports:
    - "8082:8080"
    healthcheck:
      test: [ "CMD", "/opt/bin/curl", "http://localhost:8080"]
      interval: 30s
      timeout: 5s
      retries: 5
    environment:
      SPRING_CONFIG_LOCATION: 'file:///data/hapi/application.yaml'
    networks:
      dic-4-bpe-backend:
    volumes:
    - type: bind
      source: ./dic-4/fhir/conf/application.yaml
      target: /data/hapi/application.yaml
    volumes_from:
    - hapi-curl-download:ro
    depends_on:
      hapi-curl-download:
        condition: service_completed_successfully
      dic-4-store-db:
        condition: service_healthy

  dic-4-store-init:
    image: curlimages/curl:8.12.1
    entrypoint:
      - /bin/sh
    command:
      - /tmp/init.sh
    volumes:
      - type: bind
        source: ./dic-4-store-init/init.sh
        target: /tmp/init.sh
      - type: bind
        source: ./dic-4-store-init/library-fhir-helpers.json
        target: /tmp/library-fhir-helpers.json
      - type: bind
        source: ./dic-4-store-init/library-fhir-model-definition.json
        target: /tmp/library-fhir-model-definition.json
    networks:
      dic-4-bpe-backend:
    depends_on:
      dic-4-store:
        condition: service_healthy

  dic-4-store-db:
    image: postgres:17-alpine
    networks:
      dic-4-bpe-backend:
    restart: always
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
    - type: volume
      source: dic-4-store-data
      target: /var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: fhir

secrets:
  proxy_certificate_and_int_cas.pem:
    file: ./secrets/proxy_certificate_and_int_cas.pem
  proxy_certificate_private_key.pem:
    file: ./secrets/proxy_certificate_private_key.pem
  proxy_trusted_client_cas.pem:
    file: ./secrets/proxy_trusted_client_cas.pem

  app_client_trust_certificates.pem:
    file: ./secrets/app_client_trust_certificates.pem
  app_client_certificate_private_key.pem.password:
    file: ./secrets/app_client_certificate_private_key.pem.password

  db_liquibase.password:
    file: ./secrets/db_liquibase.password

  db_zars_bpe_user.password:
    file: secrets/db_zars_bpe_user.password
  db_zars_bpe_user_camunda.password:
    file: secrets/db_zars_bpe_user_camunda.password
  app_zars_client_certificate.pem:
    file: ./secrets/app_zars_client_certificate.pem
  app_zars_client_certificate_private_key.pem:
    file: ./secrets/app_zars_client_certificate_private_key.pem
  db_fhir_zars_user.password:
    file: ./secrets/db_fhir_zars_user.password
  db_fhir_zars_user_permanent_delete.password:
    file: ./secrets/db_fhir_zars_user_permanent_delete.password

  db_dic_1_bpe_user.password:
    file: secrets/db_dic_1_bpe_user.password
  db_dic_1_bpe_user_camunda.password:
    file: secrets/db_dic_1_bpe_user_camunda.password
  app_dic_1_client_certificate.pem:
    file: ./secrets/app_dic_1_client_certificate.pem
  app_dic_1_client_certificate_private_key.pem:
    file: ./secrets/app_dic_1_client_certificate_private_key.pem
  db_fhir_dic_1_user.password:
    file: ./secrets/db_fhir_dic_1_user.password
  db_fhir_dic_1_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_1_user_permanent_delete.password

  db_dic_2_bpe_user.password:
    file: secrets/db_dic_2_bpe_user.password
  db_dic_2_bpe_user_camunda.password:
    file: secrets/db_dic_2_bpe_user_camunda.password
  app_dic_2_client_certificate.pem:
    file: ./secrets/app_dic_2_client_certificate.pem
  app_dic_2_client_certificate_private_key.pem:
    file: ./secrets/app_dic_2_client_certificate_private_key.pem
  db_fhir_dic_2_user.password:
    file: ./secrets/db_fhir_dic_2_user.password
  db_fhir_dic_2_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_2_user_permanent_delete.password

  db_dic_3_bpe_user.password:
    file: secrets/db_dic_3_bpe_user.password
  db_dic_3_bpe_user_camunda.password:
    file: secrets/db_dic_3_bpe_user_camunda.password
  app_dic_3_client_certificate.pem:
    file: ./secrets/app_dic_3_client_certificate.pem
  app_dic_3_client_certificate_private_key.pem:
    file: ./secrets/app_dic_3_client_certificate_private_key.pem
  db_fhir_dic_3_user.password:
    file: ./secrets/db_fhir_dic_3_user.password
  db_fhir_dic_3_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_3_user_permanent_delete.password

  dic_3_store_proxy.htpasswd:
    file: ./secrets/dic_3_store_proxy.htpasswd
  dic_3_store_proxy_cert_bundle.pem:
    file: ./secrets/dic_3_store_proxy_cert_bundle.pem
  dic_3_store_proxy_cert_key.pem:
    file: ./secrets/dic_3_store_proxy_cert_key.pem
  dic_3_store_proxy_self_signed_ca.p12:
    file: ./secrets/dic_3_store_proxy_self_signed_ca.p12

  db_dic_4_bpe_user.password:
    file: secrets/db_dic_4_bpe_user.password
  db_dic_4_bpe_user_camunda.password:
    file: secrets/db_dic_4_bpe_user_camunda.password
  app_dic_4_client_certificate.pem:
    file: ./secrets/app_dic_4_client_certificate.pem
  app_dic_4_client_certificate_private_key.pem:
    file: ./secrets/app_dic_4_client_certificate_private_key.pem
  db_fhir_dic_4_user.password:
    file: ./secrets/db_fhir_dic_4_user.password
  db_fhir_dic_4_user_permanent_delete.password:
    file: ./secrets/db_fhir_dic_4_user_permanent_delete.password

networks:
  internet:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.0/26
  zars-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.64/29
  zars-fhir-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.72/29
  zars-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.80/29
  zars-bpe-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.88/29
  dic-1-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.96/29
  dic-1-fhir-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.104/29
  dic-1-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.112/29
  dic-1-bpe-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.120/29
  dic-2-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.128/29
  dic-2-fhir-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.136/29
  dic-2-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.144/29
  dic-2-bpe-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.152/29
  dic-3-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.160/29
  dic-3-fhir-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.168/29
  dic-3-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.176/29
  dic-3-bpe-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.184/29
  dic-3-keycloak:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.192/29
  dic-4-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.200/29
  dic-4-fhir-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.208/29
  dic-4-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.216/29
  dic-4-bpe-backend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.10.0.224/29

volumes:
  hapi-curl-binary:

  dic-1-store-data:

  dic-2-store-data:

  dic-3-store-data:

  dic-4-store-data:

  db-data:
    name: "db-data-mii-dsf-process-feasibility"
